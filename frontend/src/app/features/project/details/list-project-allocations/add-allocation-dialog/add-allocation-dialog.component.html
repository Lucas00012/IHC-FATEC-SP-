<ng-container *ngIf="usersFiltered$ | async as users; else loading">
    <h1 mat-dialog-title>Alocar usuário</h1>
    <div mat-dialog-content [formGroup]="form">
        <mat-form-field class="maximize" appearance="outline">
            <mat-label>Selecione</mat-label>
            <input matInput [formControl]="autocomplete" [matAutocomplete]="auto">
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="userOnChange($event)">
                <mat-option *ngFor="let user of users" [value]="user">
                    {{user.name}} #{{user.id}}
                </mat-option>
            </mat-autocomplete>
        </mat-form-field>
        <mat-form-field class="maximize" appearance="outline">
            <mat-label>Responsabilidade</mat-label>
            <mat-select formControlName="responsability">
                <mat-option *ngFor="let responsability of responsabilityOptions" [value]="responsability">
                    {{ responsability }}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field class="maximize" appearance="outline" *ngIf="user.value as user; else noUser">
            <mat-label>Usuário</mat-label>
            <input matInput value="{{ user.name }} #{{ user.id }}" readonly>
        </mat-form-field>
    </div>
    <div mat-dialog-actions>
        <button mat-raised-button color="primary" class="font-white"
            (click)="onSave()" [disabled]="form.invalid">
            Salvar
        </button>
        <button mat-button mat-dialog-close>Cancelar</button>
    </div>
</ng-container>

<ng-template #loading>
    <div class="loading-spinner">
        <mat-spinner></mat-spinner>
    </div>
</ng-template>

<ng-template #noUser>
    <p>Você ainda não selecionou um usuário</p>
</ng-template>
